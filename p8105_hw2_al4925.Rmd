---
title: "p8105_hw2_al4925"
author: "Angela Lin"
date: "2025-10-01"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
```

## Problem 1
```{r}
pols_df = read.csv("fivethirtyeight_datasets/pols-month.csv", na = c("NA", "")) |>
  janitor::clean_names() |> 
  separate(col = mon, into = c("year", "month", "day")) |>
  mutate(year = as.integer(year),
         month = as.integer(month), 
         month = month.name[month],
         president = case_when(prez_gop == 1 ~ "gop", prez_dem == 1 ~ "dem")) |>
  select(-prez_dem, -prez_gop, -day)
```

```{r}
snp_df = read.csv("fivethirtyeight_datasets/snp.csv", na = c("NA", "")) |>
  janitor::clean_names() |>    
  separate(col = date, into = c("month", "day", "year"), sep = "/") |>
  mutate(year = as.integer(year),
         year = ifelse(year <= 15, year + 2000, year + 1900), 
         month = as.integer(month), 
         month = month.name[month]) |>
  relocate(year, month) |>
  select(-day)
```

```{r}
unemployment_df = read.csv("fivethirtyeight_datasets/unemployment.csv", na = c("NA", "")) |>
  janitor::clean_names() |>
  pivot_longer(jan:dec, 
               names_to = "month", 
               values_to = "unemployment_percentage") |>
  mutate(month = factor(month, levels = tolower(month.abb), labels = month.name),
         year = as.integer(year))
```

```{r}
merge_df = merge(pols_df, snp_df, by = c("year", "month"), all.x = TRUE)
merge_df = merge(merge_df, unemployment_df, by = c("year", "month"), all.x = TRUE)
```

The `pols_month`dataset contains 822 observations and 9 variables related to the number of national politicians who are democratic or republican at any given time. I rearrange the `mon` column to covert the date into month and year, and delete the day. The range of year in this dataset is from 1947 to 2015. I also combine `prez_gop` and `prez_dem` into a single column (`president`) showing whether the president is republican or democratic. 


The `snp` dataset contains 787 observations and 3 variables related to Standard & Poorâ€™s stock market index. I also change the original date column into two columns (`year` and `month`). The range of year in this dataset is from 1950 to 2015. The `close` shows the closing values of the S&P stock index on the assoicated date. 


The `unemployment` dataset contains 816 observations and 3 variables related to the percentage of unemployment in each month of the associated year. The range of year in this dataset is from 1948 to 2015.


Lastly, the `merge_df` dataset combines the three datasets together and range the year from 1947 to 2015. This merged dataset give a more organized dataset for us to further compare the relationship between stock market index + unemployment situation and the party of govenrment over time. 


## Problem 2
```{r}
mr_df = read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel", na = c("NA", "")) |>
  janitor::clean_names() |>
  select(-date, -x15, -x16) |>
  mutate(sports_balls = round(as.integer(sports_balls), 1),
         wheels = "Mr.",
         year = as.integer(year)) |>
  relocate(year, month)


prof_df = read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", na = c("NA", "")) |>
  janitor::clean_names() |>
  select(-date) |>
  mutate(wheels = "Professor",
         year = as.integer(year)) |>
  relocate(year, month)


gwy_df = read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Gwynns Falls Trash Wheel", na = c("NA", ""))  |>
  janitor::clean_names() |>
  select(-date) |>
  mutate(wheels = "Gwynnda",
         year = as.integer(year)) |>
  relocate(year, month)

```

```{r}
merge_trash_df = bind_rows(mr_df, prof_df, gwy_df) |>
  relocate(wheels) |>
  group_by(wheels, year, month) |>
  summarise(dumpster = sum(dumpster, na.rm = TRUE),
            weight_tons = sum(weight_tons, na.rm = TRUE),
            volume_cubic_yards = sum(volume_cubic_yards, na.rm = TRUE),
            plastic_bottles = sum(plastic_bottles, na.rm = TRUE),
            polystyrene = sum(polystyrene, na.rm = TRUE),
            cigarette_butts = sum(cigarette_butts, na.rm = TRUE),
            plastic_bags = sum(plastic_bags, na.rm = TRUE),
            wrappers = sum(wrappers, na.rm = TRUE),
            homes_powered = sum(homes_powered, na.rm = TRUE))
```

```{r}
trash_prof = merge_trash_df |> 
  filter(wheels == "Professor") 
total_weight_prof = sum(trash_prof$weight_tons)
total_weight_prof

cig = merge_trash_df |>
  filter(wheels == "Gwynnda", year == 2022, month == "June")
total_cig_gwy = sum(cig$cigarette_butts)
total_cig_gwy
  

```
After organizing and tidying three dataset, I combined them into a single one `merge_trash_df`. There are 269 observations and 12 variables, telling total trash weight collected based on wheels in each month in years. The total weight of trash collected by Professor Trash Wheels is 564.52 tons. The total number of cigarette butts collected by Gwynnda in June of 2022 is 18120.


## Problem 3
```{r}
zipcodes_df = read.csv("zillow_data/Zip Codes.csv", na = c("NA", "")) |>
  janitor::clean_names() |>
  select(-file_date)

```

```{r}
zori_df = read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", "")) |>
  janitor::clean_names() |>
  select(-state_name, -state, -region_type) |>
  rename(zip_code = region_name, 
         county = county_name) |>
  pivot_longer(x2015_01_31:x2024_08_31,
               names_to = "date",
               values_to = "rental_price") |>
  separate(col = date, into = c("year", "month", "day"), sep = "_") |>
  mutate(year = str_remove(year, "x"),
         year = as.integer(year),
         month = as.integer(month),
         day = as.integer(day),
         county = str_remove(county, fixed("County"))) |>
  relocate(county, year, month, day) |>
  select(-day)
  
```
```{r}
merge_rental = full_join(zipcodes_df, zori_df)
#bind_rows(zori_df, zipcodes_df) 
#|> summarise(rental_price = sum(rental_price))
#jan = merge_rental %>% filter(merge_rental$year == 2020,  merge_rental$year == 2021 & merge_rental$month == 1)

# jan = merge_rental %>% filter(merge_rental$year == 2021 & merge_rental$month == 1)


#zip_num = length(unique(merge_rental$zip_code))
#zip_num
#neighbor_num = length(unique(merge_rental$neighborhood))
#neighbor_num


```
```{r}
price_drop = jan_2021$rental_price - jan_2020$rental_price

jan_2020_price = mean(jan_2020$rental_price, na.rm = TRUE)
jan_2020_price
jan_2021_price = mean(jan_2021$rental_price, na.rm = TRUE)
jan_2021_price
```

The resulting tidy dataset is `merge_rental`. It contains 17606 observations and 13 variables. There are 320 unique ZIP code and 43 unique neighborhood included. 

